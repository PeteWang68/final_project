---
title: "Situation in 2016"
output: 
  html_document:
    toc: true
    toc_float:
      collapse: true
      smooth_scroll: false
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(plotly)
```

```{r, include = FALSE}
# data in 2016
income = read_csv("./data/Income.csv") %>% 
  janitor::clean_names()

unemployment = read_csv("./data/Unemployment.csv") %>% 
  janitor::clean_names()

education = read_csv("./data/Educational_level.csv") %>% 
  janitor::clean_names()

ctizenship = read_csv("./data/Ctizenship.csv") %>% 
  janitor::clean_names()

race = read_csv("./data/Race.csv") %>% 
  janitor::clean_names()

vote = read_csv("./data/Vote.csv") %>% 
  janitor::clean_names()

crime_rate = read_excel("./data/2016.xls",  range = cell_rows(3:53)) %>%
  janitor::clean_names() %>%
  filter(participating_state != "Total") %>%
  select(location = participating_state, population_covered,       total_number_of_incidents_reported) %>%
  mutate(crime_rate = total_number_of_incidents_reported/population_covered*100000) 


ctizenship =
  ctizenship %>% 
  select(location, non_citizen)

race = 
  race %>% 
  select(location, white)

crime_rate =
  crime_rate %>% 
  select(location, crime_rate)

merge_data = 
  merge(income, unemployment, by = "location") %>% 
  merge(., education, by = "location") %>% 
  merge(., ctizenship, by = "location") %>% 
  merge(., race, by = "location") %>% 
  merge(., vote, by = "location") %>%
  merge(., crime_rate, by = "location") %>% 
  filter(location != "United States") %>% 
  rename(state = location, share_unemployed = unemployed, share_non_citizen = non_citizen, share_white = white) %>% 
  mutate(median_annual_household_income = str_replace(median_annual_household_income, ",", "")) %>%
  mutate(median_annual_household_income = gsub("\\$", "",median_annual_household_income )) %>%
  mutate(median_annual_household_income = as.numeric(median_annual_household_income)) %>%
  select(state, median_income = median_annual_household_income, everything())
```

## Introduction

Since we found there is a significant increasement of hate crime rate in 2016, we would like to further explore the reason associated with this change. Therefore we found several datasets contain different factors relevant to the hate crime and combined them together. These factors include "Median annual household income", "Share of the population that is unemployed", "Share of the population with high school degree", "Share of the population that are not U.S. citizens", "Share of the population that is white", "Share of 2016 U.S. presidential voters who voted for Donald Trump".

## Regression
Firstly, we do the regression based on several common socioeconomic factors including "Median annual household income", "Share of the population that is unemployed", "Share of the population with high school degree", "Share of the population that are not U.S. citizens", "Share of the population that is white". After the log transforation and stepwise regression, we get model 1 as following, with median income as the only predictor.

###Model 1

```{r, echo = FALSE}
merge_data_log = merge_data %>% 
  mutate(crime_rate = log(crime_rate)) %>%
  mutate(share_voters_voted_trump = sub("\\%", "",share_voters_voted_trump))%>%
  mutate(share_voters_voted_trump = as.numeric(share_voters_voted_trump)/100)
```

```{r, echo = FALSE}
crime_income_slr = lm(crime_rate~median_income, data = merge_data_log)
summary(crime_income_slr) %>%
  broom::tidy() %>%
  knitr::kable()

scatter_plot_1 = merge_data_log %>%
  ggplot(aes(x = median_income,y = crime_rate)) +
  geom_smooth(method = "lm", color = "blue", formula = y ~ x) +
  geom_point()+
  labs(
    title = "Scatterplot between hate crime rate and Median annual household income",
    x = "Median annual household income",
    y = "Hate crime rate(per 100,000 population)",
    caption = "Data from FBI"
  )
```

$$log\textrm{ crime_rate} = -0.74 + 0.000021 \textrm{median_income}$$

<<<<<<< HEAD
After that, we enter the factor of Share of 2016 U.S. presidential voters who voted for Donald Trump to make the prediction since a significant crime increase has been observed with the election. After log transformation and stepwise, the second model is thus made. 

###Model 2

=======
>>>>>>> 56c70956f1f8f24818d3c6af3715cb3dd2be405a
```{r, echo = FALSE}
crime_trump_slr = lm(crime_rate~share_voters_voted_trump, data = merge_data_log)
summary(crime_trump_slr) %>%
  broom::tidy() %>%
  knitr::kable()

scatter_plot_2 = merge_data_log %>%
  ggplot(aes(x = share_voters_voted_trump, y = crime_rate)) +
  geom_smooth(method = "lm", color = "blue", formula = y ~ x) +
  geom_point()+
  labs(
    title = "Scatterplot between hate crime rate and shared voters who voted Trump",
    x = "Median annual household income",
    y = "Hate crime rate(per 100,000 population)",
    caption = "Data from FBI"
  ) 
  ggplotly(scatter_plot_2)
```

$$log\textrm{ crime_rate} = 2.03 - 3.06 \textrm{share_voters_voted_trump}$$

